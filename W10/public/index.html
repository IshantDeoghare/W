<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do List</title>
  <style>
    body{font-family:Arial;max-width:600px;margin:2rem auto;}
    input,button{padding:.5rem;font-size:1rem;}
    li{display:flex;justify-content:space-between;padding:.5rem;border-bottom:1px solid #ddd;}
    .completed{text-decoration:line-through;color:#888;}
  </style>
</head>
<body>
  <h1>To-Do List</h1>
  <input id="newTask" placeholder="Add a task..." />
  <button id="addBtn">Add</button>
  <ul id="list"></ul>

  <script>
    const listEl = document.getElementById('list');
    const newTaskEl = document.getElementById('newTask');
    const addBtn = document.getElementById('addBtn');

       async function load() {
      const res = await fetch('/api/todos');
      const todos = await res.json();
      listEl.innerHTML = '';
      todos.forEach(renderTodo);
    }

    // Render single item
    function renderTodo(todo) {
      const li = document.createElement('li');
      li.dataset.id = todo.id;
      li.innerHTML = `
        <span class="${todo.completed ? 'completed' : ''}">${todo.text}</span>
        <div>
          <button data-action="toggle">${todo.completed ? 'Undo' : 'Done'}</button>
          <button data-action="delete">Delete</button>
        </div>`;
      listEl.appendChild(li);
    }

    // Add new task
    addBtn.onclick = async () => {
      const text = newTaskEl.value.trim();
      if (!text) return;
      const res = await fetch('/api/todos', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ text })
      });
      const todo = await res.json();
      renderTodo(todo);
      newTaskEl.value = '';
    };

    // Delegate list clicks
    listEl.onclick = async e => {
      const li = e.target.closest('li');
      const id = li.dataset.id;
      if (e.target.dataset.action === 'toggle') {
        const completed = li.querySelector('span').classList.toggle('completed');
        await fetch(`/api/todos/${id}`, {
          method: 'PUT',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ completed })
        });
      } else if (e.target.dataset.action === 'delete') {
        await fetch(`/api/todos/${id}`, { method: 'DELETE' });
        li.remove();
      }
    };

    // Initial load
    load();
  </script>
</body>
</html>